(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/jawj/OverlappingMarkerSpiderfier
Copyright (c) 2011 - 2013 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Note: The Google Maps API v3 must be included *before* this code
*/
var w={}.hasOwnProperty,x=[].slice;
this.OverlappingMarkerSpiderfier=function(){function s(b,d){var a,g,f,e;this.map=b;null==d&&(d={});for(a in d)w.call(d,a)&&(g=d[a],this[a]=g);this.e=new this.constructor.g(this.map);this.n();this.b={};e=["click","zoom_changed","maptypeid_changed"];g=0;for(f=e.length;g<f;g++)a=e[g],n.addListener(this.map,a,function(a){return function(){return a.unspiderfy()}}(this))}var n,r,p,q,h,c,u,v;c=s.prototype;v=[s,c];q=0;for(h=v.length;q<h;q++)p=v[q],p.VERSION="0.3.3";r=google.maps;n=r.event;h=r.MapTypeId;u=
2*Math.PI;c.keepSpiderfied=!1;c.markersWontHide=!1;c.markersWontMove=!1;c.nearbyDistance=20;c.circleSpiralSwitchover=9;c.circleFootSeparation=23;c.circleStartAngle=u/12;c.spiralFootSeparation=26;c.spiralLengthStart=11;c.spiralLengthFactor=4;c.spiderfiedZIndex=1E3;c.usualLegZIndex=10;c.highlightedLegZIndex=20;c.event="click";c.legWeight=1.5;c.legColors={usual:{},highlighted:{}};q=c.legColors.usual;p=c.legColors.highlighted;q[h.HYBRID]=q[h.SATELLITE]="#fff";p[h.HYBRID]=p[h.SATELLITE]="#f00";q[h.TERRAIN]=
q[h.ROADMAP]="#444";p[h.TERRAIN]=p[h.ROADMAP]="#f00";c.n=function(){this.a=[];this.j=[]};c.addMarker=function(b){var d;if(null!=b._oms)return this;b._oms=!0;d=[n.addListener(b,this.event,function(a){return function(d){return a.G(b,d)}}(this))];this.markersWontHide||d.push(n.addListener(b,"visible_changed",function(a){return function(){return a.o(b,!1)}}(this)));this.markersWontMove||d.push(n.addListener(b,"position_changed",function(a){return function(){return a.o(b,!0)}}(this)));this.j.push(d);this.a.push(b);
return this};c.o=function(b,d){if(null!=b._omsData&&(d||!b.getVisible())&&null==this.s&&null==this.t)return this.unspiderfy(d?b:null)};c.getMarkers=function(){return this.a.slice(0)};c.removeMarker=function(b){var d,a,g,f,e;null!=b._omsData&&this.unspiderfy();d=this.m(this.a,b);if(0>d)return this;g=this.j.splice(d,1)[0];f=0;for(e=g.length;f<e;f++)a=g[f],n.removeListener(a);delete b._oms;this.a.splice(d,1);return this};c.clearMarkers=function(){var b,d,a,g,f,e,c,l;this.unspiderfy();l=this.a;b=g=0;
for(e=l.length;g<e;b=++g){a=l[b];d=this.j[b];f=0;for(c=d.length;f<c;f++)b=d[f],n.removeListener(b);delete a._oms}this.n();return this};c.addListener=function(b,d){var a;(null!=(a=this.b)[b]?a[b]:a[b]=[]).push(d);return this};c.removeListener=function(b,d){var a;a=this.m(this.b[b],d);0>a||this.b[b].splice(a,1);return this};c.clearListeners=function(b){this.b[b]=[];return this};c.trigger=function(){var b,d,a,g,f,e;d=arguments[0];b=2<=arguments.length?x.call(arguments,1):[];d=null!=(a=this.b[d])?a:[];
e=[];g=0;for(f=d.length;g<f;g++)a=d[g],e.push(a.apply(null,b));return e};c.u=function(b,d){var a,g,f,e,c;f=this.circleFootSeparation*(2+b)/u;g=u/b;c=[];for(a=e=0;0<=b?e<b:e>b;a=0<=b?++e:--e)a=this.circleStartAngle+a*g,c.push(new r.Point(d.x+f*Math.cos(a),d.y+f*Math.sin(a)));return c};c.v=function(b,d){var a,g,f,e,c;f=this.spiralLengthStart;a=0;c=[];for(g=e=0;0<=b?e<b:e>b;g=0<=b?++e:--e)a+=this.spiralFootSeparation/f+5E-4*g,g=new r.Point(d.x+f*Math.cos(a),d.y+f*Math.sin(a)),f+=u*this.spiralLengthFactor/
a,c.push(g);return c};c.G=function(b,d){var a,g,f,e,c,l,k,t,m;(e=null!=b._omsData)&&this.keepSpiderfied||this.unspiderfy();if(e||this.map.getStreetView().getVisible()||"GoogleEarthAPI"===this.map.getMapTypeId())return this.trigger("click",b,d);e=[];c=[];a=this.nearbyDistance;l=a*a;f=this.c(b.position);m=this.a;k=0;for(t=m.length;k<t;k++)a=m[k],null!=a.map&&a.getVisible()&&(g=this.c(a.position),this.f(g,f)<l?e.push({B:a,p:g}):c.push(a));return 1===e.length?this.trigger("click",b,d):this.H(e,c)};c.markersNearMarker=
function(b,d){var a,g,f,e,c,l,k,t,m,n;null==d&&(d=!1);if(null==this.e.getProjection())throw"Must wait for 'idle' event on map before calling markersNearMarker";a=this.nearbyDistance;c=a*a;f=this.c(b.position);e=[];t=this.a;l=0;for(k=t.length;l<k&&!(a=t[l],a!==b&&null!=a.map&&a.getVisible()&&(g=this.c(null!=(m=null!=(n=a._omsData)?n.l:void 0)?m:a.position),this.f(g,f)<c&&(e.push(a),d)));l++);return e};c.markersNearAnyOtherMarker=function(){var b,d,a,g,f,e,c,l,k,n,m,h;if(null==this.e.getProjection())throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";
e=this.nearbyDistance;b=e*e;g=this.a;e=[];m=0;for(a=g.length;m<a;m++)d=g[m],e.push({q:this.c(null!=(c=null!=(k=d._omsData)?k.l:void 0)?c:d.position),d:!1});m=this.a;d=c=0;for(k=m.length;c<k;d=++c)if(a=m[d],null!=a.map&&a.getVisible()&&(g=e[d],!g.d))for(h=this.a,a=l=0,n=h.length;l<n;a=++l)if(f=h[a],a!==d&&null!=f.map&&f.getVisible()&&(f=e[a],(!(a<d)||f.d)&&this.f(g.q,f.q)<b)){g.d=f.d=!0;break}m=this.a;a=[];b=c=0;for(k=m.length;c<k;b=++c)d=m[b],e[b].d&&a.push(d);return a};c.A=function(b){return{h:function(d){return function(){return b._omsData.i.setOptions({strokeColor:d.legColors.highlighted[d.map.mapTypeId],
zIndex:d.highlightedLegZIndex})}}(this),k:function(d){return function(){return b._omsData.i.setOptions({strokeColor:d.legColors.usual[d.map.mapTypeId],zIndex:d.usualLegZIndex})}}(this)}};c.H=function(b,d){var a,c,f,e,h,l,k,q,m,p;this.s=!0;p=b.length;a=this.D(function(){var a,d,c;c=[];a=0;for(d=b.length;a<d;a++)q=b[a],c.push(q.p);return c}());e=p>=this.circleSpiralSwitchover?this.v(p,a).reverse():this.u(p,a);a=function(){var a,d,p;p=[];a=0;for(d=e.length;a<d;a++)f=e[a],c=this.F(f),m=this.C(b,function(a){return function(b){return a.f(b.p,
f)}}(this)),k=m.B,l=new r.Polyline({map:this.map,path:[k.position,c],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),k._omsData={l:k.position,i:l},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(h=this.A(k),k._omsData.w={h:n.addListener(k,"mouseover",h.h),k:n.addListener(k,"mouseout",h.k)}),k.setPosition(c),k.setZIndex(Math.round(this.spiderfiedZIndex+f.y)),p.push(k);return p}.call(this);delete this.s;
this.r=!0;return this.trigger("spiderfy",a,d)};c.unspiderfy=function(b){var d,a,c,f,e,h,l;null==b&&(b=null);if(null==this.r)return this;this.t=!0;f=[];c=[];l=this.a;e=0;for(h=l.length;e<h;e++)a=l[e],null!=a._omsData?(a._omsData.i.setMap(null),a!==b&&a.setPosition(a._omsData.l),a.setZIndex(null),d=a._omsData.w,null!=d&&(n.removeListener(d.h),n.removeListener(d.k)),delete a._omsData,f.push(a)):c.push(a);delete this.t;delete this.r;this.trigger("unspiderfy",f,c);return this};c.f=function(b,d){var a,
c;a=b.x-d.x;c=b.y-d.y;return a*a+c*c};c.D=function(b){var d,a,c,f,e;f=a=c=0;for(e=b.length;f<e;f++)d=b[f],a+=d.x,c+=d.y;b=b.length;return new r.Point(a/b,c/b)};c.c=function(b){return this.e.getProjection().fromLatLngToDivPixel(b)};c.F=function(b){return this.e.getProjection().fromDivPixelToLatLng(b)};c.C=function(b,c){var a,g,f,e,h,l;f=h=0;for(l=b.length;h<l;f=++h)if(e=b[f],e=c(e),"undefined"===typeof a||null===a||e<g)g=e,a=f;return b.splice(a,1)[0]};c.m=function(b,c){var a,g,f,e;if(null!=b.indexOf)return b.indexOf(c);
a=f=0;for(e=b.length;f<e;a=++f)if(g=b[a],g===c)return a;return-1};s.g=function(b){return this.setMap(b)};s.g.prototype=new r.OverlayView;s.g.prototype.draw=function(){};return s}();})();
